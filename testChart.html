<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script class="jquery library" src="http://code.jquery.com/jquery-1.8.2.min.js" type="text/javascript"></script>
  <script src="http://static.bmob.cn/bmob-min.js"></script> 
  <script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
  <title>哎系列后台报表统计</title>

  <script id="jquery_182" type="text/javascript" class="library" src="/js/sandbox/jquery/jquery-1.8.2.min.js"></script>

  </head>
<body>
    <div class='content'>
    <header>
      <h1 class="title">
	<select  class="selector1">
		<option value ="7">最近7天</option>
		<option value ="30">最近一个月</option>
		<option value="90">最近3个月</option>
		<option value="180">最近半年个月</option>
		<option value="365">最近一年个月</option>
	</select>
	</h1>
      <h1 class="title">数据爬取</h1>
    </header>
    <div id="main" style="height:500px;"></div>
    <header>
      <h1 class="title">数据积压</h1>
    </header>
    <div id="sender" style="height:500px;"></div>
			
  <script type="text/javascript">
  $(".selector1").change(function(){

     // 先清空第二个
	var selecteditem=$(".selector1").val();
	myFunction(0,"main",selecteditem);
	myFunction(2,"sender",selecteditem);
	//alert($(".selector1").val());

});
/*	$(".selector1").change(function(){

     // 先清空第二个
	var selecteditem=$(".selector1").val();
	myFunction(0,"main",selecteditem);
	myFunction(2,"sender",selecteditem);
	//alert($(".selector1").val());

});*/
	myFunction(0,"main",7);
	myFunction(2,"sender",7);
function myFunction(inputtype,layout,days)
{
	//alert("Hello World!");
	
	//Bmob.initialize("Application ID", "REST API Key");
    Bmob.initialize("69f77c763c1dfdfb45ffa1b925ed7ca9", "aade001c77e009552a24b35d51b08434");
	
	//alert("imei");
        var aaa=30;
				//alert("asd");
        require.config({
            paths: {
                echarts: 'http://echarts.baidu.com/build/dist'
            },
            packages: [
                {
                    name: 'echarts',
                    location: '../../src',
                    main: 'echarts'
                },
                {
                    name: 'zrender',
                    location: 'http://ecomfe.github.io/zrender/src',
                    //location: '../../../zrender/src',
                    main: 'zrender'
                }
            ]
        });
        var myChart ;
        require(
            [
                'echarts',
                'echarts/chart/line',
                'echarts/chart/bar'
            ],
            function (ec) {
				
				var option = {
					tooltip : {
						trigger: 'axis'
					},
					legend: {
						data:['总量','一日一美女','幽默笑话','搞笑趣图']
					},
					toolbox: {
						show : true,
						feature : {
							mark : {show: true},
							dataView : {show: true, readOnly: false},
							magicType : {show: true, type: ['line', 'bar']},
							restore : {show: true},
							saveAsImage : {show: true}
						}
					},
					calculable : true,
					xAxis : [
						{
							type : 'category',
							data : ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月']
						}
					],
					yAxis : [
						{
							type : 'value',
							splitArea : {show : true}
						}
					],
					series : [
						{
							name:'蒸发量',
							type:'bar',
							data:[2.0, 4.9, 7.0, aaa, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3]
						}
					]
				};
        myChart = ec.init(document.getElementById(layout));
				
				myChart.showLoading({
					text: "图表数据正在努力加载..."
				});
	
				//获取一行数据
				var GameScore = Bmob.Object.extend("LogBean");
				var query = new Bmob.Query(GameScore);
				query.equalTo("type","statusdb");
				query.equalTo("model","db");
				query.limit(days);
				query.find( {
				  success: function(object) {
					//alert(object[0].get("record"));
					var ttxt=object[0].get("record");
						
					var series_1 = new Array();
					var series_21 = new Array();
					var series_22 = new Array();
					var series_23 = new Array();
					var xAxis_1 = new Array();
					
					for (i=object.length-1;i>=0;i--)
					{
						//alert(object[i].get("record").split("|")[0].split("*"));
						var obj=object[i].get("record");
						series_1[i] = obj.split("*")[inputtype];
						var obj2=obj.split("*")[inputtype+1].split("|");
						series_21[i] = obj2[0];
						series_22[i] = obj2[1];
						series_23[i] = obj2[2];
						xAxis_1[i]=obj.split("*")[4].split(" ")[0];
						//x.get("record").split("|")[0].split("*");
					}
					//alert(mycars);
					//ttxt.split("|");
					//alert(ttxt.split("|")[0].split("*"));
					// The object was retrieved successfully.
					aaa=100;
					option.series=[
						{
							name:'总量',
							type:'bar',
							data:series_1
						},
						{
							name:'一日一美女',
							type:'bar',
							data:series_21
						},
						{
							name:'幽默笑话',
							type:'bar',
							data:series_22
						},
						{
							name:'搞笑趣图',
							type:'bar',
							data:series_23
						}
					];
						option.xAxis= [
						{
							type : 'category',
							data : xAxis_1
						}
					]
					//myChart.setOption(option);
					//myChart.refresh();
					//myChart.showLoading();
					//setTimeout(refresh, 1000);
					//myChart.setOption(option, true)
					//myChart.refresh();
					//alert(object.get("imei"));
					myChart.hideLoading();
					myChart.setOption(option);
				  },
				  error: function(object, error) {
					alert("query object fail");
				  }
				});
            }
        );
		
}
  </script>
</body>
</html>
